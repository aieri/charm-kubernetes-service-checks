# Note(sudeephb): The charms which are not supported in jammy, or 
# cause errors on other related charms are deployed in focal
series: jammy
applications:
    kubernetes-service-checks:
        num_units: 1
    containerd:
        charm: ch:containers-containerd
        series: focal
        options:
            gpu_driver: none
        resources: {}
    easyrsa:
        charm: ch:containers-easyrsa
        num_units: 1
        series: focal
    etcd:
        charm: ch:etcd
        num_units: 1
    flannel:
        charm: ch:containers-flannel
        series: focal
    kubernetes-master:
        charm: ch:kubernetes-control-plane
        num_units: 1
        constraints: cores=4 mem=4G root-disk=16G
        series: focal
    kubernetes-worker:
        charm: ch:kubernetes-worker
        expose: true
        num_units: 3
        constraints: cores=4 mem=4G root-disk=16G
        series: focal
        options:
            kubelet-extra-config: '{protectKernelDefaults: false}'
    nrpe:
        charm: ch:nrpe
relations:
    - - kubernetes-master:kube-api-endpoint
      - kubernetes-worker:kube-api-endpoint
    - - kubernetes-service-checks:nrpe-external-master
      - nrpe:nrpe-external-master
    - - kubernetes-master:kube-control
      - kubernetes-worker:kube-control
    - - kubernetes-master:certificates
      - easyrsa:client
    - - etcd:certificates
      - easyrsa:client
    - - kubernetes-master:etcd
      - etcd:db
    - - kubernetes-worker:certificates
      - easyrsa:client
    - - flannel:etcd
      - etcd:db
    - - flannel:cni
      - kubernetes-master:cni
    - - flannel:cni
      - kubernetes-worker:cni
    - - containerd:containerd
      - kubernetes-worker:container-runtime
    - - containerd:containerd
      - kubernetes-master:container-runtime
    - - kubernetes-service-checks:kube-control
      - kubernetes-master:kube-control
    - - kubernetes-service-checks:kube-api-endpoint
      - kubernetes-master:kube-api-endpoint
